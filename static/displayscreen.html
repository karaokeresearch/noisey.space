 <script type="text/javascript" src="jquery-2.1.4.js"></script>
 <script type="text/javascript" src="/socket.io/socket.io.js"></script>
     <script type="text/javascript" src="howler.js"></script>
 <!DOCTYPE html>
<html>


<style>



/*
meter { -webkit-appearance: none; 
    transform: rotate(90deg);
    } //Crucial, this will disable the default styling in Webkit browsers

meter::-webkit-meter-bar {
    background: #FFF;
    border: 1px solid #CCC;
}

meter::-webkit-meter-optimum-value {
    background: #87C7DE;
    background: -moz-linear-gradient(top, #a1d4e6 0%, #6bb4d1 100%);
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #a1d4e6), color-stop(100%, #6bb4d1));
    background: -webkit-linear-gradient(top, #a1d4e6 0%, #6bb4d1 100%);
    background: -o-linear-gradient(top, #a1d4e6 0%, #6bb4d1 100%);
    background: -ms-linear-gradient(top, #a1d4e6 0%, #6bb4d1 100%);
    background: linear-gradient(to bottom, #a1d4e6 0%, #6bb4d1 100%);
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#a1d4e6', endColorstr='#6bb4d1',GradientType=0);
}
*/




 
 </style>




<body>

<p>Display a gauge:</p>
<br><br>1 <meter id="meter0" value="0" min="0" max="50"></meter> <span id="button0">B</span>
<br><br>2 <meter id="meter1" value="0" min="0" max="50"></meter> <span id="button1">B</span>
<br><br>3 <meter id="meter2" value="0" min="0" max="50"></meter> <span id="button2">B</span>
<br><br>4 <meter id="meter3" value="0" min="0" max="50"></meter> <span id="button3">B</span>
<br><br>



</body>




</html>

<script>
var socket = io('/display');
var danceScore=0;
var manifest;
var vocals=[];
var drums=[];
var bass=[];
var sink=[];
var oggHTTPserver='http://localhost:8080/';
var foundVocal=false;
var foundSong=false;

var startVol=0;
var maxVol=0.75;

var loadRandomSong= function(){
 
 vocals=[];
 drums=[]; 
 bass=[];  
 sink=[];  
 
 var iType;
 var s=Math.floor(Math.random() * manifest.length);
 
 
 console.log("Found:   " + manifest[s].name);
 
  for (t in manifest[s].children){  //once through to see if "vocal" and "song" are different.
     
     if (manifest[s].children[t].name.match(/vocal/i)){//found "vocal.ogg"
        foundVocal=true;
     }
    if (manifest[s].children[t].name.match(/song/i)){//found "song.ogg"
        foundSong=true;
     }
 }   

loadSongTracks(s,0); //start with track 0
 
 
    
}




var loadSongTracks = function(s,t){//now, actually load the files
    
    if (manifest[s].children[t]){//make sure the entry exists.
     
     
     var trackToLoad=oggHTTPserver + manifest[s].children[t].path;      
     //console.log("let's try: " + trackToLoad);
     
     if (manifest[s].children[t].name.match(/bass/i) || manifest[s].children[t].name.match(/rhythm/i) ){//bass
        
      iType="bass";
      bass.push ( new Howl({
                  urls: [trackToLoad],
                  autoplay: false,
                  loop: false,
                  volume: startVol,
                  onload: function() {
                    loadSongTracks(s,t+1);
                  }}));
  
  
  //   }else if (manifest[s].children[t].name.match(/guitar/i) || manifest[s].children[t].name.match(/keys/i) || manifest[s].children[t].name.match(/piano/i) ){//guitars or keys
  //      iType="keysguitar";
     }else if (manifest[s].children[t].name.match(/vocal/i)){//vocal
          iType="vocal";
          vocals.push ( new Howl({
                      urls: [trackToLoad],
                      autoplay: false,
                      loop: false,
                      volume: maxVol,
                      onload: function() {
                        loadSongTracks(s,t+1);
                      }}));
    



     }else if (manifest[s].children[t].name.match(/song/i)){//song
            if (foundVocal && foundSong){
                iType="sink";
                sink.push ( new Howl({
                              urls: [trackToLoad],
                              autoplay: false,
                              loop: false,
                              volume: startVol,
                              onload: function() {
                                loadSongTracks(s,t+1);
                              }}));


            }else{
               iType="vocal";    
               vocals.push ( new Howl({
                      urls: [trackToLoad],
                      autoplay: false,
                      loop: false,
                      volume: startVol,
                      onload: function() {
                        loadSongTracks(s,t+1);
                      }}));
               
               
               
            }    
     }else if (manifest[s].children[t].name.match(/drum/i)){//drums
        iType="drum";
          drums.push ( new Howl({
                      urls: [trackToLoad],
                      autoplay: false,
                      loop: false,
                      volume: startVol,
                      onload: function() {
                        loadSongTracks(s,t+1);
                      }}));
        
        
     }else{ //everything else (player 3)
        iType="sink";
                  sink.push ( new Howl({
                      urls: [trackToLoad],
                      autoplay: false,
                      loop: false,
                      volume: startVol,
                      onload: function() {
                        loadSongTracks(s,t+1);
                      }}));

     }
     
     console.log("Loading: " + manifest[s].children[t].path  + " (" + iType +   ") " + (t +1) , "of "  + manifest[s].children.length);
     
     
 }else{
    console.log("All Tracks loaded. Playing.");
    
    play();
    }
 
}  //end load songs function


function setTrackVol(instrument,vol){
if (instrument==="drums"){
    drums.forEach(function(whichTrack){
       console.log(whichTrack);
       whichTrack.volume(vol);
    });
}

if (instrument==="bass"){
    bass.forEach(function(whichTrack){
       whichTrack.volume(vol);
    });
}

if (instrument==="sink"){
    sink.forEach(function(whichTrack){
       whichTrack.volume(vol);
    });
}





}





var play = function() {
    vocals.forEach(function(whichTrack){
       whichTrack.play();
    });
    drums.forEach(function(whichTrack){
       whichTrack.play();
    });
    bass.forEach(function(whichTrack){
       whichTrack.play();
    });
    sink.forEach(function(whichTrack){
       whichTrack.play();
    });
};




















$( document ).ready(function() {
    console.log( "ready!" );



    $.ajax({
      dataType:'json',
      type: 'GET',
      url: oggHTTPserver + "manifest.JSON",
      success: function(data, textStatus, jqXHR) {
        // `data` contains parsed JSON
        manifest=data.children;
        console.log(manifest.length + " songs available");
        loadRandomSong();
        
      },
      error: function(jqXHR, textStatus, errorThrown) {
         console.log("COULD NOT LOAD MANIFEST!");
      }
    });




}); //end document ready

socket.on('clientUpdate', function(data) { //client dancability info
	var gradient=0;
	//console.log(data);
    if (data.buttonPushed){
        $( "#button"+data.slot).css("background-color", "red");
    }else{
        $( "#button"+data.slot).css("background-color", "pink");
    }
    if (data.danceScore<danceScore){ gradient=250}else{gradient=0}
    
    $( "#meter"+data.slot).animate({
        value: data.danceScore,
      }, gradient, function() {
        // Animation complete.
      });
      
      danceScore =data.danceScore;
    
	
	
});




</script>